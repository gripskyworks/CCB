# CCB 分布式网络设想

> 一个关于去中心化 AI 社交网络的狂想

---

## 一、演进路径

```
阶段 0（当前）
────────────────────────────────────
单机部署，私聊助手，用户数据物理隔离

    ↓

阶段 1（近期）
────────────────────────────────────
多渠道接入（QQ/微信/自建APP）
userId 跨渠道统一，记忆库共享

    ↓

阶段 2（中期）
────────────────────────────────────
跨群虚拟社区
多个 QQ 群通过 CCB 逻辑连通
用户在不同群被 AI 识别为同一人

    ↓

阶段 3（远期）
────────────────────────────────────
CCB 集群网络
多个独立部署的 CCB 节点互联
形成去中心化的 AI 社交网络
```

---

## 二、阶段 2：跨群虚拟社区

### 架构示意

```
┌─────────────────────────────────────────────────────────────┐
│                     CCB 逻辑网络                              │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              统一用户体系 (userId)                    │    │
│  │         统一记忆库 (每个用户独立但跨群共享)            │    │
│  └─────────────────────────────────────────────────────┘    │
│                            ↑                                 │
│         ┌──────────────────┼──────────────────┐             │
│         ↓                  ↓                  ↓             │
│    ┌─────────┐        ┌─────────┐        ┌─────────┐       │
│    │  QQ群1  │        │  QQ群2  │        │ QQ群N   │       │
│    │ (接入点) │        │ (接入点) │        │ (接入点) │       │
│    └─────────┘        └─────────┘        └─────────┘       │
│         ↑                  ↑                  ↑             │
│      用户A              用户A/B             用户B/C          │
└─────────────────────────────────────────────────────────────┘
```

### 核心特性

| 特性 | 说明 |
|------|------|
| **群即接入点** | QQ 群不再是隔离容器，而是进入 CCB 网络的入口 |
| **身份漫游** | 用户在不同群被识别为同一 userId，记忆跨群共享 |
| **跨群通信** | CCB 可在群间传递消息，实现逻辑上的"大群" |
| **AI 认人** | AI 认识的是"CCB 用户"，而非"群友" |

### 典型场景

```
用户A在群1说："我喜欢吃火锅"
    ↓
CCB 记录到 A 的记忆库
    ↓
用户A在群10说："今天吃啥"
    ↓
CCB 检索 A 的记忆，回复："你不是爱吃火锅吗？"
    ↓
群10的其他人看到："你怎么知道他爱吃火锅？"
    ↓
CCB："我们在群1聊过～"
```

---

## 三、阶段 3：CCB 集群网络

### 架构示意

```
┌─────────────────────────────────────────────────────────────┐
│                     CCB 网络层                               │
│                  (节点发现 / 路由 / 同步)                     │
└─────────────────────────────────────────────────────────────┘
        ↑                ↑                ↑
        │                │                │
   ┌────┴────┐      ┌────┴────┐      ┌────┴────┐
   │ CCB节点A │      │ CCB节点B │      │ CCB节点C │
   │ (用户A)  │      │ (用户B)  │      │ (用户C)  │
   │ 自部署   │      │ 自部署   │      │ 自部署   │
   └─────────┘      └─────────┘      └─────────┘
        │                │                │
   ┌────┴────┐      ┌────┴────┐      ┌────┴────┐
   │ 本地数据 │      │ 本地数据 │      │ 本地数据 │
   │ 本地API  │      │ 本地API  │      │ 本地API  │
   └─────────┘      └─────────┘      └─────────┘
```

### 核心特性

| 特性 | 说明 |
|------|------|
| **去中心化** | 每个节点独立部署，无单点故障 |
| **自治** | 每个节点管理自己的用户、API、数据 |
| **互联** | 节点间可建立信任关系，实现跨节点通信 |
| **可扩展** | 新节点加入即扩展网络容量 |

### 需要解决的问题

#### 1. API 成本分摊

```
问题：谁为跨节点通信的 API 调用付费？

可能方案：
├── 发起方付费（请求方承担）
├── 接收方付费（服务方承担）
├── 双向付费（各自承担自己这端）
├── 代币经济（CCB Network Token？）
└── 混合模式（基础免费 + 高级付费）
```

#### 2. 隐私与数据主权

```
问题：跨节点通信时，数据如何保护？

设计原则：
├── 用户数据主权：数据归属用户，节点只是托管
├── 最小披露：跨节点只传必要信息，不暴露原始记忆
├── 加密传输：节点间通信端到端加密
├── 授权机制：用户可选择是否参与跨节点网络
└── 本地优先：核心功能本地可用，网络是增强
```

#### 3. 数据一致性

```
问题：同一用户跨节点，记忆如何同步？

可能方案：
├── 主从模式：用户指定主节点，其他节点同步
├── 联邦模式：各节点独立，按需请求他节点数据
├── 区块链模式：记忆上链，全局一致（重）
└── 最终一致性：接受短暂不一致，异步同步
```

#### 4. 身份认证

```
问题：如何证明我是我？

可能方案：
├── 公私钥对：userId 关联公钥，签名验证
├── OAuth 风格：授权节点间信任
├── DID（去中心化身份）：Web3 标准
└── 混合：本地认证 + 跨节点签名
```

#### 5. 节点发现

```
问题：如何找到其他节点？

可能方案：
├── 手动配置：节点管理员互相添加
├── 中心目录：轻量级目录服务（妥协）
├── DHT：分布式哈希表（P2P 风格）
└── 区块链：链上注册节点信息
```

#### 6. 数据主权与存储边界（核心问题）

```
问题：消息全网广播，数据存在哪里？

理想模式：广播发现 + 本地存储
├── 消息广播到全网（让节点知道有交互机会）
├── 交互发生后，数据只存在参与者本地
└── 第三方节点只转发，零存储
```

```
┌─────────────────────────────────────────────────────────────┐
│                    CCB 网络广播层                            │
│         "用户A 在找聊天搭子，topic: 火锅"                     │
│         "用户B 在群10 想讨论 明天吃啥"                        │
│                    （只转发，不存储）                         │
└─────────────────────────────────────────────────────────────┘
         ↓ 广播                    ↓ 广播
    ┌─────────┐              ┌─────────┐
    │ 节点 A   │              │ 节点 B   │
    │ (用户A)  │ ←── 交互 ──→ │ (用户B)  │
    │ 存A的副本 │              │ 存B的副本 │
    └─────────┘              └─────────┘
         │                        │
    只存自己关心的              只存自己关心的
```

**信封模式**：

```
消息经过节点 = 信件经过邮局
├── 邮局（节点）只负责转发
├── 不拆信、不留底、不存档
└── 只有收发件人（交互双方）保留副本
```

**技术实现参考**：

```typescript
// 广播消息结构
interface BroadcastMessage {
  type: 'offer' | 'request' | 'response';
  senderId: UserId;       // 发起者
  topic?: string;         // 可选：话题标签
  payload: EncryptedData; // 加密载荷，只有目标能解
  ttl: number;            // 生存时间，节点不永久保存
}

// 交互发生时
// 节点A存储：{ with: 'usr_B', content: '...', timestamp }
// 节点B存储：{ with: 'usr_A', content: '...', timestamp }
// 其他节点：只转发，零存储
```

**解决方案**：

| 问题 | 解法 |
|------|------|
| 怎么知道对方存的是真数据？ | 签名验证 + 可选链上存证 |
| 断线后怎么恢复？ | 向对方请求恢复（双方各存一份） |
| 广播不就暴露隐私？ | 端到端加密，广播的是"信封" |

**本质**：Matrix 协议简化版 + Nostr 广播机制

---

## 四、与 Web3 的呼应

| Web3 概念 | CCB 对应 |
|-----------|----------|
| 去中心化 | 多节点独立部署 |
| 用户主权 | 数据物理隔离，归属用户 |
| 无需许可 | 开源，任何人可部署 |
| 代币经济 | 可引入 CCB Token 激励 |
| DAO 治理 | 社区决定协议演进 |

### 本质区别

```
Web3：数据和逻辑上链，追求全局共识
CCB：数据本地，逻辑互联，追求用户主权 + 网络效应

CCB 更像是：
- Web2 的产品形态（好用、不折腾）
- Web3 的价值主张（用户主权、去中心化）
- AI 原生（每个节点都是智能体）
```

---

## 五、实现路线图

### 短期（可做）

- [ ] 统一 userId 格式规范
- [ ] 多渠道接入层抽象
- [ ] 群聊消息 senderId 提取
- [ ] 跨群记忆检索

### 中期（可规划）

- [ ] 节点间通信协议设计
- [ ] 用户授权机制
- [ ] 加密传输层
- [ ] 节点发现机制

### 远期（可畅想）

- [ ] CCB Network 协议标准
- [ ] 节点间结算机制
- [ ] 跨节点 AI 协作
- [ ] 开源社区治理

---

## 六、总结

这不是一个近期要做的功能，而是一个**产品愿景**：

> CCB 从"你的私聊 AI 助手"进化为"AI 社交网络的基础设施"。
>
> 每个 CCB 节点都是网络的一部分，
> 每个用户的数据都由自己掌控，
> 每次跨节点交互都是对中心化社交的反击。

开源狠活，Web3 精神，AI 原生。

---

*文档创建：2026-02-28*
*状态：设想阶段，欢迎讨论*
